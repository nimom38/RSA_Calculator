{"ast":null,"code":"/* global BigInt */\nconst randojs = require(\"@nastyox/rando.js\");\n\nconst rando = randojs.rando;\nexport const initialState = {\n  p: \"0\",\n  q: \"0\",\n  n: \"0\",\n  phi: \"0\",\n  e: \"0\",\n  d: \"0\",\n  test: \"0\",\n  errorbag: []\n};\n\nconst power = (a, b, n) => {\n  [a, b, n] = [BigInt(a), BigInt(b), BigInt(n)];\n  let res = BigInt(1);\n  a %= n;\n\n  while (b > BigInt(0)) {\n    if (b & BigInt(1)) res = res * a % n;\n    b >>= BigInt(1);\n    a = a * a % n;\n  }\n\n  return res;\n};\n\nfunction modInverse(a, m) {\n  [a, m] = [BigInt(a), BigInt(m)];\n  a = (a % m + m) % m;\n\n  if (!a || m < BigInt(2)) {\n    return NaN; // invalid input\n  } // find the gcd\n\n\n  const s = [];\n  let b = m;\n\n  while (b) {\n    [a, b] = [b, a % b];\n    s.push({\n      a,\n      b\n    });\n  }\n\n  if (a !== BigInt(1)) {\n    return NaN; // inverse does not exists\n  } // find the inverse\n\n\n  let x = BigInt(1);\n  let y = BigInt(0);\n\n  for (let i = s.length - 2; i >= 0; --i) {\n    [x, y] = [y, x - y * (s[i].a / s[i].b)];\n  }\n\n  return (y % m + m) % m;\n}\n\nconst millerTest = (d, n) => {\n  [d, n] = [BigInt(d), BigInt(n)];\n  const a = BigInt(2) + BigInt(rando(100000000, 10000000000000000000000)) % (n - BigInt(4));\n  let p = power(a, d, n);\n  if (p === BigInt(1) || p === n - BigInt(1)) return true;\n\n  while (d !== n - BigInt(1)) {\n    p = p * p % n;\n    d *= BigInt(2);\n    if (p === BigInt(1)) return false;\n    if (p === n - BigInt(1)) return true;\n  }\n\n  return false;\n};\n\nconst checkPrime = n => {\n  n = BigInt(n);\n  if (n <= BigInt(1) || n === BigInt(4)) return false;\n  if (n <= BigInt(3)) return true;\n  let d = n - BigInt(1);\n\n  while (d % BigInt(2) === BigInt(0)) d /= BigInt(2);\n\n  for (var i = 0; i < 2000; ++i) {\n    if (!millerTest(d, n)) return false;\n  }\n\n  return true;\n};\n\nconst gcd = (a, b) => {\n  [a, b] = [BigInt(a), BigInt(b)];\n  if (a === BigInt(0)) return b;\n  if (b === BigInt(0)) return a;\n  return gcd(b, a % b);\n};\n\nconst reducer = (state, action) => {\n  console.log(action);\n  console.log(state);\n\n  switch (action.type) {\n    case \"SET_P_AND_Q\":\n      {\n        const p = BigInt(action.item.p);\n        const q = BigInt(action.item.q);\n\n        if (!checkPrime(p) || !checkPrime(q)) {\n          return { ...state,\n            errorbag: [{\n              message: \"P and Q should be prime numbers.\"\n            }]\n          };\n        }\n\n        if (p * q <= 127) {\n          return { ...state,\n            errorbag: [{\n              message: \"P * Q is less than 127.\"\n            }]\n          };\n        }\n\n        const n = p * q;\n        const phi = (p - BigInt(1)) * (q - BigInt(1));\n        return { ...state,\n          p: p.toString(),\n          q: q.toString(),\n          n: n.toString(),\n          phi: phi.toString(),\n          errorbag: []\n        };\n      }\n\n    case \"SET_E\":\n      {\n        const e = BigInt(action.item.e);\n\n        if (e <= 1 || e >= BigInt(state.phi)) {\n          return { ...state,\n            errorbag: [{\n              message: \"e must be greater than 1 and less than phi.\"\n            }]\n          };\n        }\n\n        if (gcd(e, state.phi) !== BigInt(1)) {\n          return { ...state,\n            errorbag: [{\n              message: \"The gcd of e and phi is not 1.\"\n            }]\n          };\n        }\n\n        const d = BigInt(modInverse(e, state.phi));\n        const test = d % BigInt(state.phi) * (e % BigInt(state.phi)) % BigInt(state.phi);\n        return { ...state,\n          e: e.toString(),\n          d: d.toString(),\n          test: test.toString(),\n          errorbag: []\n        };\n      }\n\n    default:\n      return state;\n  }\n};\n\nexport default reducer;","map":{"version":3,"sources":["/mnt/b37daa4f-64b1-411a-b35c-59820ce6f767/Documents/Projects/rsa-calculator/src/Reducer.js"],"names":["randojs","require","rando","initialState","p","q","n","phi","e","d","test","errorbag","power","a","b","BigInt","res","modInverse","m","NaN","s","push","x","y","i","length","millerTest","checkPrime","gcd","reducer","state","action","console","log","type","item","message","toString"],"mappings":"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","sourcesContent":["/* global BigInt */\n\nconst randojs = require(\"@nastyox/rando.js\");\nconst rando = randojs.rando;\n\nexport const initialState = {\n  p: \"0\",\n  q: \"0\",\n  n: \"0\",\n  phi: \"0\",\n  e: \"0\",\n  d: \"0\",\n  test: \"0\",\n  errorbag: [],\n};\n\nconst power = (a, b, n) => {\n  [a, b, n] = [BigInt(a), BigInt(b), BigInt(n)];\n  let res = BigInt(1);\n  a %= n;\n  while (b > BigInt(0)) {\n    if (b & BigInt(1)) res = (res * a) % n;\n    b >>= BigInt(1);\n    a = (a * a) % n;\n  }\n  return res;\n};\n\nfunction modInverse(a, m) {\n  [a, m] = [BigInt(a), BigInt(m)];\n\n  a = ((a % m) + m) % m;\n  if (!a || m < BigInt(2)) {\n    return NaN; // invalid input\n  }\n  // find the gcd\n  const s = [];\n  let b = m;\n  while (b) {\n    [a, b] = [b, a % b];\n    s.push({ a, b });\n  }\n  if (a !== BigInt(1)) {\n    return NaN; // inverse does not exists\n  }\n  // find the inverse\n  let x = BigInt(1);\n  let y = BigInt(0);\n  for (let i = s.length - 2; i >= 0; --i) {\n    [x, y] = [y, x - y * (s[i].a / s[i].b)];\n  }\n  return ((y % m) + m) % m;\n}\n\nconst millerTest = (d, n) => {\n  [d, n] = [BigInt(d), BigInt(n)];\n  const a =\n    BigInt(2) +\n    (BigInt(rando(100000000, 10000000000000000000000)) % (n - BigInt(4)));\n  let p = power(a, d, n);\n  if (p === BigInt(1) || p === n - BigInt(1)) return true;\n\n  while (d !== n - BigInt(1)) {\n    p = (p * p) % n;\n    d *= BigInt(2);\n\n    if (p === BigInt(1)) return false;\n\n    if (p === n - BigInt(1)) return true;\n  }\n  return false;\n};\n\nconst checkPrime = (n) => {\n  n = BigInt(n);\n\n  if (n <= BigInt(1) || n === BigInt(4)) return false;\n  if (n <= BigInt(3)) return true;\n  let d = n - BigInt(1);\n\n  while (d % BigInt(2) === BigInt(0)) d /= BigInt(2);\n  for (var i = 0; i < 2000; ++i) {\n    if (!millerTest(d, n)) return false;\n  }\n  return true;\n};\n\nconst gcd = (a, b) => {\n  [a, b] = [BigInt(a), BigInt(b)];\n  if (a === BigInt(0)) return b;\n  if (b === BigInt(0)) return a;\n  return gcd(b, a % b);\n};\n\nconst reducer = (state, action) => {\n  console.log(action);\n  console.log(state);\n  switch (action.type) {\n    case \"SET_P_AND_Q\": {\n      const p = BigInt(action.item.p);\n      const q = BigInt(action.item.q);\n      if (!checkPrime(p) || !checkPrime(q)) {\n        return {\n          ...state,\n          errorbag: [{ message: \"P and Q should be prime numbers.\" }],\n        };\n      }\n      if (p * q <= 127) {\n        return {\n          ...state,\n          errorbag: [{ message: \"P * Q is less than 127.\" }],\n        };\n      }\n      const n = p * q;\n      const phi = (p - BigInt(1)) * (q - BigInt(1));\n      return {\n        ...state,\n        p: p.toString(),\n        q: q.toString(),\n        n: n.toString(),\n        phi: phi.toString(),\n        errorbag: [],\n      };\n    }\n    case \"SET_E\": {\n      const e = BigInt(action.item.e);\n\n      if (e <= 1 || e >= BigInt(state.phi)) {\n        return {\n          ...state,\n          errorbag: [\n            { message: \"e must be greater than 1 and less than phi.\" },\n          ],\n        };\n      }\n\n      if (gcd(e, state.phi) !== BigInt(1)) {\n        return {\n          ...state,\n          errorbag: [{ message: \"The gcd of e and phi is not 1.\" }],\n        };\n      }\n\n      const d = BigInt(modInverse(e, state.phi));\n\n      const test =\n        ((d % BigInt(state.phi)) * (e % BigInt(state.phi))) % BigInt(state.phi);\n\n      return {\n        ...state,\n        e: e.toString(),\n        d: d.toString(),\n        test: test.toString(),\n        errorbag: [],\n      };\n    }\n    default:\n      return state;\n  }\n};\n\nexport default reducer;\n"]},"metadata":{},"sourceType":"module"}