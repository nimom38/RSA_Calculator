{"ast":null,"code":"/* global BigInt */\nconst randojs = require(\"@nastyox/rando.js\");\n\nconst rando = randojs.rando;\nexport const initialState = {\n  p: \"0\",\n  q: \"0\",\n  n: \"0\",\n  phi: \"0\",\n  e: \"0\",\n  d: \"0\",\n  cipher: \"\",\n  message: \"\",\n  errorbag: []\n};\n\nconst power = (a, b, n) => {\n  [a, b, n] = [BigInt(a), BigInt(b), BigInt(n)];\n  let res = BigInt(1);\n  a %= n;\n\n  while (b > BigInt(0)) {\n    if (b & BigInt(1)) res = res * a % n;\n    b >>= BigInt(1);\n    a = a * a % n;\n  }\n\n  return res;\n};\n\nfunction modInverse(a, m) {\n  [a, m] = [BigInt(a), BigInt(m)];\n  a = (a % m + m) % m;\n\n  if (!a || m < BigInt(2)) {\n    return NaN; // invalid input\n  } // find the gcd\n\n\n  const s = [];\n  let b = m;\n\n  while (b) {\n    [a, b] = [b, a % b];\n    s.push({\n      a,\n      b\n    });\n  }\n\n  if (a !== BigInt(1)) {\n    return NaN; // inverse does not exists\n  } // find the inverse\n\n\n  let x = BigInt(1);\n  let y = BigInt(0);\n\n  for (let i = s.length - 2; i >= 0; --i) {\n    [x, y] = [y, x - y * (s[i].a / s[i].b)];\n  }\n\n  return (y % m + m) % m;\n}\n\nconst millerTest = (d, n) => {\n  [d, n] = [BigInt(d), BigInt(n)];\n  const a = BigInt(2) + BigInt(rando(100000000, 10000000000000000000000)) % (n - BigInt(4));\n  let p = power(a, d, n);\n  if (p === BigInt(1) || p === n - BigInt(1)) return true;\n\n  while (d !== n - BigInt(1)) {\n    p = p * p % n;\n    d *= BigInt(2);\n    if (p === BigInt(1)) return false;\n    if (p === n - BigInt(1)) return true;\n  }\n\n  return false;\n};\n\nconst checkPrime = n => {\n  n = BigInt(n);\n  if (n <= BigInt(1) || n === BigInt(4)) return false;\n  if (n <= BigInt(3)) return true;\n  let d = n - BigInt(1);\n\n  while (d % BigInt(2) === BigInt(0)) d /= BigInt(2);\n\n  for (var i = 0; i < 2000; ++i) {\n    if (!millerTest(d, n)) return false;\n  }\n\n  return true;\n};\n\nconst gcd = (a, b) => {\n  [a, b] = [BigInt(a), BigInt(b)];\n  if (a === BigInt(0)) return b;\n  if (b === BigInt(0)) return a;\n  return gcd(b, a % b);\n};\n\nconst encryptMessage = (message, e, n, phi) => {\n  [e, n] = [BigInt(e), BigInt(n)];\n  if (e <= BigInt(1) || e >= BigInt(phi)) return \"\";\n  if (n <= BigInt(127)) return \"\";\n  const cipher = [];\n\n  for (var i = 0; i < message.length; ++i) {\n    const character = BigInt(message.charCodeAt(i));\n    const encrypted = power(character, e, n);\n    cipher.push(encrypted.toString());\n  }\n\n  return btoa(String.fromCharCode(...cipher));\n};\n\nconst decryptCipher = (cipher, d, n) => {\n  [d, n] = [BigInt(d), BigInt(n)];\n  if (d <= BigInt(0)) return \"\";\n  if (n <= BigInt(127)) return \"\";\n  const originalMessage = [];\n\n  for (var i = 0; i < cipher.length; ++i) {\n    const character = BigInt(cipher.charCodeAt(i));\n    const decrypted = power(character, d, n);\n    originalMessage.push(decrypted.toString());\n  }\n\n  return String.fromCharCode(...originalMessage);\n};\n\nconst reducer = (state, action) => {\n  console.log(action);\n  console.log(state);\n\n  switch (action.type) {\n    case \"SET_P_AND_Q\":\n      {\n        const p = BigInt(action.item.p);\n        const q = BigInt(action.item.q);\n\n        if (!checkPrime(p) || !checkPrime(q)) {\n          return { ...state,\n            errorbag: [{\n              message: \"P and Q should be prime numbers.\"\n            }]\n          };\n        }\n\n        if (p * q <= 127) {\n          return { ...state,\n            errorbag: [{\n              message: \"P * Q is less than 127.\"\n            }]\n          };\n        }\n\n        const n = p * q;\n        const phi = (p - BigInt(1)) * (q - BigInt(1));\n        return { ...state,\n          p: p.toString(),\n          q: q.toString(),\n          n: n.toString(),\n          phi: phi.toString(),\n          errorbag: []\n        };\n      }\n\n    case \"SET_E\":\n      {\n        const e = BigInt(action.item.e);\n\n        if (e <= 1 || e >= BigInt(state.phi)) {\n          return { ...state,\n            errorbag: [{\n              message: \"e must be greater than 1 and less than phi.\"\n            }]\n          };\n        }\n\n        if (gcd(e, state.phi) !== BigInt(1)) {\n          return { ...state,\n            errorbag: [{\n              message: \"The gcd of e and phi is not 1.\"\n            }]\n          };\n        }\n\n        const d = BigInt(modInverse(e, state.phi));\n        return { ...state,\n          e: e.toString(),\n          d: d.toString(),\n          errorbag: []\n        };\n      }\n\n    case \"Encrypt\":\n      {\n        const message = action.item.message;\n        const cipher = encryptMessage(message, state.e, state.n, state.phi);\n        console.log(cipher);\n        return { ...state,\n          cipher,\n          errorbag: []\n        };\n      }\n\n    case \"Decrypt\":\n      {\n        const cipher = action.item.cipher;\n        const message = decryptCipher(cipher, state.d, state.n);\n        return { ...state,\n          message,\n          errorbag: []\n        };\n      }\n\n    default:\n      return state;\n  }\n};\n\nexport default reducer;","map":{"version":3,"sources":["/mnt/b37daa4f-64b1-411a-b35c-59820ce6f767/Documents/Projects/rsa-calculator/src/Reducer.js"],"names":["randojs","require","rando","initialState","p","q","n","phi","e","d","cipher","message","errorbag","power","a","b","BigInt","res","modInverse","m","NaN","s","push","x","y","i","length","millerTest","checkPrime","gcd","encryptMessage","character","charCodeAt","encrypted","toString","btoa","String","fromCharCode","decryptCipher","originalMessage","decrypted","reducer","state","action","console","log","type","item"],"mappings":"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","sourcesContent":["/* global BigInt */\n\nconst randojs = require(\"@nastyox/rando.js\");\nconst rando = randojs.rando;\n\nexport const initialState = {\n  p: \"0\",\n  q: \"0\",\n  n: \"0\",\n  phi: \"0\",\n  e: \"0\",\n  d: \"0\",\n  cipher: \"\",\n  message: \"\",\n  errorbag: [],\n};\n\nconst power = (a, b, n) => {\n  [a, b, n] = [BigInt(a), BigInt(b), BigInt(n)];\n  let res = BigInt(1);\n  a %= n;\n  while (b > BigInt(0)) {\n    if (b & BigInt(1)) res = (res * a) % n;\n    b >>= BigInt(1);\n    a = (a * a) % n;\n  }\n  return res;\n};\n\nfunction modInverse(a, m) {\n  [a, m] = [BigInt(a), BigInt(m)];\n\n  a = ((a % m) + m) % m;\n  if (!a || m < BigInt(2)) {\n    return NaN; // invalid input\n  }\n  // find the gcd\n  const s = [];\n  let b = m;\n  while (b) {\n    [a, b] = [b, a % b];\n    s.push({ a, b });\n  }\n  if (a !== BigInt(1)) {\n    return NaN; // inverse does not exists\n  }\n  // find the inverse\n  let x = BigInt(1);\n  let y = BigInt(0);\n  for (let i = s.length - 2; i >= 0; --i) {\n    [x, y] = [y, x - y * (s[i].a / s[i].b)];\n  }\n  return ((y % m) + m) % m;\n}\n\nconst millerTest = (d, n) => {\n  [d, n] = [BigInt(d), BigInt(n)];\n  const a =\n    BigInt(2) +\n    (BigInt(rando(100000000, 10000000000000000000000)) % (n - BigInt(4)));\n  let p = power(a, d, n);\n  if (p === BigInt(1) || p === n - BigInt(1)) return true;\n\n  while (d !== n - BigInt(1)) {\n    p = (p * p) % n;\n    d *= BigInt(2);\n\n    if (p === BigInt(1)) return false;\n\n    if (p === n - BigInt(1)) return true;\n  }\n  return false;\n};\n\nconst checkPrime = (n) => {\n  n = BigInt(n);\n\n  if (n <= BigInt(1) || n === BigInt(4)) return false;\n  if (n <= BigInt(3)) return true;\n  let d = n - BigInt(1);\n\n  while (d % BigInt(2) === BigInt(0)) d /= BigInt(2);\n  for (var i = 0; i < 2000; ++i) {\n    if (!millerTest(d, n)) return false;\n  }\n  return true;\n};\n\nconst gcd = (a, b) => {\n  [a, b] = [BigInt(a), BigInt(b)];\n  if (a === BigInt(0)) return b;\n  if (b === BigInt(0)) return a;\n  return gcd(b, a % b);\n};\n\nconst encryptMessage = (message, e, n, phi) => {\n  [e, n] = [BigInt(e), BigInt(n)];\n\n  if (e <= BigInt(1) || e >= BigInt(phi)) return \"\";\n  if (n <= BigInt(127)) return \"\";\n\n  const cipher = [];\n\n  for (var i = 0; i < message.length; ++i) {\n    const character = BigInt(message.charCodeAt(i));\n    const encrypted = power(character, e, n);\n    cipher.push(encrypted.toString());\n  }\n  return btoa(String.fromCharCode(...cipher));\n};\n\nconst decryptCipher = (cipher, d, n) => {\n  [d, n] = [BigInt(d), BigInt(n)];\n\n  if (d <= BigInt(0)) return \"\";\n  if (n <= BigInt(127)) return \"\";\n\n  const originalMessage = [];\n\n  for (var i = 0; i < cipher.length; ++i) {\n    const character = BigInt(cipher.charCodeAt(i));\n    const decrypted = power(character, d, n);\n    originalMessage.push(decrypted.toString());\n  }\n  return String.fromCharCode(...originalMessage);\n};\n\nconst reducer = (state, action) => {\n  console.log(action);\n  console.log(state);\n  switch (action.type) {\n    case \"SET_P_AND_Q\": {\n      const p = BigInt(action.item.p);\n      const q = BigInt(action.item.q);\n      if (!checkPrime(p) || !checkPrime(q)) {\n        return {\n          ...state,\n          errorbag: [{ message: \"P and Q should be prime numbers.\" }],\n        };\n      }\n      if (p * q <= 127) {\n        return {\n          ...state,\n          errorbag: [{ message: \"P * Q is less than 127.\" }],\n        };\n      }\n      const n = p * q;\n      const phi = (p - BigInt(1)) * (q - BigInt(1));\n      return {\n        ...state,\n        p: p.toString(),\n        q: q.toString(),\n        n: n.toString(),\n        phi: phi.toString(),\n        errorbag: [],\n      };\n    }\n    case \"SET_E\": {\n      const e = BigInt(action.item.e);\n\n      if (e <= 1 || e >= BigInt(state.phi)) {\n        return {\n          ...state,\n          errorbag: [\n            { message: \"e must be greater than 1 and less than phi.\" },\n          ],\n        };\n      }\n\n      if (gcd(e, state.phi) !== BigInt(1)) {\n        return {\n          ...state,\n          errorbag: [{ message: \"The gcd of e and phi is not 1.\" }],\n        };\n      }\n\n      const d = BigInt(modInverse(e, state.phi));\n\n      return {\n        ...state,\n        e: e.toString(),\n        d: d.toString(),\n        errorbag: [],\n      };\n    }\n    case \"Encrypt\": {\n      const message = action.item.message;\n      const cipher = encryptMessage(message, state.e, state.n, state.phi);\n\n      console.log(cipher);\n\n      return {\n        ...state,\n        cipher,\n        errorbag: [],\n      };\n    }\n    case \"Decrypt\": {\n      const cipher = action.item.cipher;\n      const message = decryptCipher(cipher, state.d, state.n);\n\n      return {\n        ...state,\n        message,\n        errorbag: [],\n      };\n    }\n    default:\n      return state;\n  }\n};\n\nexport default reducer;\n"]},"metadata":{},"sourceType":"module"}